function [BW,maskedImage] = segmentImageWithGrab(X)
%segmentImage Segment image using auto-generated code from imageSegmenter app
%  [BW,MASKEDIMAGE] = segmentImage(X) segments image X using auto-generated
%  code from the imageSegmenter app. The final segmentation is returned in
%  BW, and a masked image is returned in MASKEDIMAGE.

% Auto-generated by imageSegmenter app on 09-Jul-2022
%----------------------------------------------------


X=rgb2gray(X)
% 图割
foregroundInd = [346928 347848 349688 351529 356129 357051 360731 361651 363491 365331 366251 366253 368093 369933 370854 372694 372724 372726 374534 374564 375456 375483 377298 377321 377323 379138 379161 380059 380081 381899 383739 383741 383759 384661 384679 386501 386518 386519 388341 388358 389263 389276 389278 391103 391116 392944 392954 393864 393874 395706 395711 395713 397546 397551 398466 398468 398469 398471 400306 400308 401226 401228 ];
backgroundInd = [33153 33155 34991 37750 41430 46028 48786 53385 57985 60745 62585 69943 74543 79143 86503 92943 95703 102143 104903 111343 114103 117783 122385 126985 129745 134345 137105 141705 146305 149066 152746 153668 157348 160108 162870 164710 169310 171151 173911 176671 178511 181271 183111 185871 189551 190471 194151 195073 196913 198753 199673 201513 203355 204275 206115 207955 208875 212555 213475 215315 217155 219915 221755 222675 226355 227275 229115 230035 231875 233715 234635 236475 238315 239235 241075 242915 243835 245675 247515 248435 250275 252115 253035 254875 256715 256716 257636 259476 261316 262236 264076 265916 266836 ];
L = superpixels(X,7902);
BW = lazysnapping(X,L,foregroundInd,backgroundInd);

% 使用 disk 执行掩膜开运算
radius = 30;
decomposition = 0;
se = strel('disk', radius, decomposition);
BW = imopen(BW, se);

% Create masked image.
maskedImage = X;
maskedImage(~BW) = 0;
end

